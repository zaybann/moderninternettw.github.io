<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Point History - One Star</title>
    <style>
        :root { 
            --primary-yellow: #FFD700; 
            --accent-red: #FF5252; 
        }
        body { 
            font-family: 'Pyidaungsu', sans-serif; background: #f8f9fa; 
            margin: 0; padding: 15px; 
        }
        
        /* --- Full Screen Loading --- */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 9999; display: flex;
            flex-direction: column; align-items: center; justify-content: center;
        }
        .loader {
            border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-yellow);
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .header { 
            background: var(--primary-yellow); padding: 18px; border-radius: 15px;
            font-weight: bold; text-align: center; margin-bottom: 10px; color: #d35400;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .btn-back {
            display: block; width: 100%; padding: 12px; margin-bottom: 20px;
            background: #333; color: white; border: none; border-radius: 10px;
            font-weight: bold; text-align: center; text-decoration: none;
            box-sizing: border-box; transition: 0.3s; font-size: 14px;
        }
        .btn-back:active { transform: scale(0.98); background: #000; }

        .history-item {
            background: white; padding: 15px; border-radius: 12px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            border-left: 6px solid #2ecc71;
        }

        .details h4 { margin: 0; color: #333; font-size: 16px; font-weight: bold; }
        .details p { margin: 5px 0 0; font-size: 12px; color: #888; }

        .amount { font-weight: bold; color: #2ecc71; font-size: 18px; }

        .empty-msg {
            text-align: center; padding: 50px 20px; color: #999; font-size: 14px;
        }
    </style>
</head>
<body>

<div id="loading-screen">
    <div class="loader"></div>
    <p style="margin-top:15px; color: #777;">á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸ á€†á€½á€²á€šá€°á€”á€±á€á€Šá€º...</p>
</div>

<div class="header">ğŸ“œ á€™á€­á€™á€­á á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸</div>

<a href="home.html" class="btn-back">ğŸ  á€•á€„á€ºá€™á€…á€¬á€™á€»á€€á€ºá€”á€¾á€¬á€á€­á€¯á€· á€•á€¼á€”á€ºá€›á€”á€º</a>

<div id="historyList">
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCUk-1FHFjhIVDD4foYuKHM7PyT_A1A1vk",
        authDomain: "twod-aa6c1.firebaseapp.com",
        projectId: "twod-aa6c1",
        storageBucket: "twod-aa6c1.appspot.com",
        messagingSenderId: "674076613631",
        appId: "1:674076613631:android:b21b4027ebe6f6f169e5ca"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    firebase.auth().onAuthStateChanged(user => {
        if (user) {
            db.collection("users").doc(user.uid).collection("history")
              .orderBy("timestamp", "desc")
              .onSnapshot(snapshot => {
                
                let html = "";
                
                if (snapshot.empty) {
                    html = `
                    <div class="empty-msg">
                        <div style="font-size: 40px; margin-bottom: 10px;">ğŸ“‹</div>
                        á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€»á€¬á€¸ á€™á€›á€¾á€­á€á€±á€¸á€•á€«á‹
                    </div>`;
                } else {
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        html += `
                        <div class="history-item">
                            <div class="details">
                                <h4>${data.type || 'Lucky Card'}</h4>
                                <p>ğŸ“… ${data.date} | ğŸ•’ ${data.time}</p>
                            </div>
                            <div class="amount">+${(data.amount || 0).toLocaleString()} á€€á€»á€•á€º</div>
                        </div>`;
                    });
                }
                
                document.getElementById('historyList').innerHTML = html;
                document.getElementById('loading-screen').style.display = 'none';

            }, error => {
                console.error("Error fetching data:", error);
                document.getElementById('loading-screen').style.display = 'none';
            });
        } else {
            window.location.href = "index.html";
        }
    });
</script>
<script>(function(s){s.dataset.zone='10545270',s.src='https://gizokraijaw.net/vignette.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
</body>
    </html>
