<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Morning (12:01 PM)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --bg-dark: #001f3f; --bg-card: #003366; --accent-blue: #007bff; --white: #ffffff; --navy-btn: #002d5a; --red-badge: #ff3b30; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
        body { background-color: var(--bg-dark); color: var(--white); padding-bottom: 100px; }
        .header { display: flex; align-items: center; padding: 15px; background: #001f3f; border-bottom: 1px solid rgba(0,123,255,0.2); position: sticky; top: 0; z-index: 100; }
        .back-btn { color: white; text-decoration: none; font-size: 20px; width: 40px; }
        .header-title { flex-grow: 1; text-align: center; font-size: 18px; font-weight: bold; }
        .num-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 15px; }
        .num-box { background: var(--bg-card); aspect-ratio: 1; display: flex; align-items: center; justify-content: center; font-size: 18px; font-weight: bold; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); cursor: pointer; }
        .num-box.selected { background: var(--accent-blue); border-color: #fff; }
        .footer-action { position: fixed; bottom: 0; width: 100%; background: #001f3f; padding: 15px; border-top: 1px solid rgba(0,123,255,0.2); display: flex; gap: 10px; }
        .f-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; }
        .btn-r { background: var(--navy-btn); }
        .btn-clear { background: #444; }
        .btn-bet { background: var(--accent-blue); position: relative; }
        .badge { position: absolute; top: -10px; right: -10px; background: var(--red-badge); width: 22px; height: 22px; border-radius: 50%; font-size: 12px; display: none; align-items: center; justify-content: center; border: 2px solid #001f3f; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: var(--bg-card); width: 90%; max-width: 400px; padding: 25px; border-radius: 15px; }
        input[type="number"] { width: 100%; padding: 12px; margin: 15px 0; border-radius: 8px; border: 1px solid var(--accent-blue); background: #001f3f; color: white; font-size: 16px; outline: none; }
    </style>
</head>
<body>

    <div class="header">
        <a href="index.html" class="back-btn"><i class="fas fa-chevron-left"></i></a>
        <div class="header-title">12:01 PM Section</div>
    </div>

    <div class="num-grid" id="grid"></div>

    <div class="footer-action">
        <button class="f-btn btn-clear" onclick="clearAll()">Clear</button>
        <button class="f-btn btn-r" onclick="applyR()">R (အာ)</button>
        <button class="f-btn btn-bet" onclick="openModal()">
            ထိုးမည် <div class="badge" id="badge">0</div>
        </button>
    </div>

    <div class="modal" id="betModal">
        <div class="modal-content">
            <h3>ထိုးကြေးသတ်မှတ်ပါ</h3>
            <input type="number" id="amt" value="100" min="100" placeholder="အနည်းဆုံး ၁၀၀ ကျပ်">
            <div style="display: flex; gap: 10px;">
                <button class="f-btn btn-clear" onclick="closeModal()">ပယ်ဖျက်</button>
                <button class="f-btn btn-bet" onclick="goToConfirm()">အတည်ပြုသည်</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCUk-1FHFjhIVDD4foYuKHM7PyT_A1A1vk",
            authDomain: "twod-aa6c1.firebaseapp.com",
            projectId: "twod-aa6c1",
            storageBucket: "twod-aa6c1.appspot.com",
            messagingSenderId: "674076613631",
            appId: "1:674076613631:android:b21b4027ebe6f6f169e5ca"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let selected = new Set();
        const grid = document.getElementById('grid');
        const badge = document.getElementById('badge');

        // Create Numbers 00-99
        for (let i=0; i<=99; i++) {
            let n = i.toString().padStart(2, '0');
            let box = document.createElement('div'); 
            box.className = 'num-box'; 
            box.id = 'n-'+n; 
            box.innerText = n;
            box.onclick = () => { 
                if(selected.has(n)) { 
                    selected.delete(n); 
                    document.getElementById('n-'+n).classList.remove('selected'); 
                } else { 
                    selected.add(n); 
                    document.getElementById('n-'+n).classList.add('selected'); 
                } 
                badge.innerText = selected.size; 
                badge.style.display = selected.size > 0 ? 'flex' : 'none'; 
            };
            grid.appendChild(box);
        }

        window.applyR = function() { 
            let toAdd = []; 
            selected.forEach(n => { 
                let r = n.split('').reverse().join(''); 
                if(!selected.has(r)) toAdd.push(r); 
            }); 
            toAdd.forEach(n => { 
                selected.add(n); 
                document.getElementById('n-'+n).classList.add('selected'); 
            }); 
            badge.innerText = selected.size; 
            badge.style.display = selected.size > 0 ? 'flex' : 'none'; 
        }

        window.clearAll = function() { 
            selected.clear(); 
            document.querySelectorAll('.num-box').forEach(b => b.classList.remove('selected')); 
            badge.style.display = 'none'; 
        }

        window.openModal = function() { if(selected.size > 0) document.getElementById('betModal').style.display = 'flex'; }
        window.closeModal = function() { document.getElementById('betModal').style.display = 'none'; }

        // ဂဏန်းပိတ်စစ်ဆေးပြီး Confirm သွားသည့်အပိုင်း
        window.goToConfirm = async function() {
            const price = document.getElementById('amt').value;
            if (price < 100) return Swal.fire("အမှား", "အနည်းဆုံး ၁၀၀ ကျပ် ထိုးရပါမည်", "error");

            // Admin ပိတ်ဂဏန်းများကို စစ်ဆေးခြင်း
            const closeSnap = await getDoc(doc(db, "settings", "close_numbers"));
            if (closeSnap.exists()) {
                const closedStr = closeSnap.data().section_12 || ""; // ၁၂:၀၁ အတွက်
                const closedArr = closedStr.split(',');
                const currentSelected = Array.from(selected);
                const found = currentSelected.filter(n => closedArr.includes(n));

                if (found.length > 0) {
                    Swal.fire({
                        title: "ဂဏန်းပိတ်ထားပါသည်",
                        text: "ဂဏန်း (" + found.join(',') + ") မှာ ပိတ်သွားသောကြောင့် ထိုး၍မရပါ။",
                        icon: "error",
                        background: "#002d5a",
                        color: "#fff"
                    });
                    return;
                }
            }

            const data = { 
                nums: Array.from(selected), 
                price: price, 
                time: "12:01 PM", 
                type: "2D Morning" 
            };
            localStorage.setItem('tempBet', JSON.stringify(data));
            window.location.href = "bet_confirm.html";
        }

        // Admin က အချိန်ပိတ်လိုက်လျှင် ကန်ထုတ်မည့်အပိုင်း
        onSnapshot(doc(db, "settings", "time_control"), (docSnap) => {
            if (docSnap.exists() && !docSnap.data().section_12) {
                Swal.fire({
                    title: "အချိန်ပြည့်ပါပြီ",
                    text: "ပင်မစာမျက်နှာသို့ ပြန်သွားပါမည်။",
                    icon: "warning",
                    showConfirmButton: false,
                    timer: 2000,
                    background: "#002d5a",
                    color: "#fff"
                }).then(() => { window.location.href = "index.html"; });
            }
        });
                // Admin ပိတ်ဂဏန်းများကို အနီရောင်ဖြင့် ပြသရန် ဖြည့်စွက်ချက်
        onSnapshot(doc(db, "settings", "close_numbers"), (docSnap) => {
            if (docSnap.exists()) {
                const closedStr = docSnap.data().section_12 || "";
                const closedArr = closedStr.split(',').map(n => n.trim());

                // အရင်ရှိနေသော အနီရောင်များကို ဖယ်ရှားခြင်း
                document.querySelectorAll('.num-box').forEach(box => {
                    box.style.backgroundColor = ""; 
                    box.style.color = "";
                });

                // ပိတ်ဂဏန်းများကို အနီရောင်ပြောင်းခြင်း
                closedArr.forEach(num => {
                    const targetBox = document.getElementById('n-' + num);
                    if (targetBox) {
                        targetBox.style.backgroundColor = "var(--red-badge)";
                        targetBox.style.color = "white";
                    }
                });
            }
        });

    </script>
</body>
</html>
